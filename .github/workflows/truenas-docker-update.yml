name: Docker1 Update
on:
  push:
    branches:
      - main
    paths:
      - 'truenas-docker/docker-compose.yaml'
      - '.github/workflows/truenas-docker-update.yml'
  workflow_dispatch:
jobs:
  docker1-update:
    name: Docker1 Update
    runs-on: ubuntu-latest
    steps:
      - uses: Azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      - id: az
        uses: Azure/get-keyvault-secrets@v1
        with: 
          keyvault: overlord-vault
          secrets: >
            JENKINS-TRUENAS-DOCKER-UPDATE-TOKEN,
            OVERLORD-URL
      - run: >-
          curl -X POST -H 'Content-Type: application/json' -d '{"forceUpdate": true}'
          ${{ steps.az.outputs.OVERLORD-URL }}/jenkins-webhook?token=${{ steps.az.outputs.JENKINS-TRUENAS-DOCKER-UPDATE-TOKEN }} 